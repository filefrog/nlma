---
#
# runway/nlma.yml - Nagios Local Monitoring Agent Configuration
#

###########################################################################
# Global Configuration (agent options)

parents:
  default:
    - nag01.monitoring.dev.opal.synacor.com:5667

send_nsca: /usr/local/bin/send_nsca_compat
plugin_root: /opt/synacor/monitor/plugins

user:  nlma
group: nlma

checkin:
  interval: 60
  service: nlma_poller

log:
  facility: daemon
  level:    warning

timeout: 8


---
###########################################################################
# Local Configuration (check definitions)

###########################################################################
# nlma/cpu.erb

normal_cpu:
  command: "check_cpu -n 10 -w 15: -c 5:"

notfound:
  command: "enoent"

notfound2:
  command: "enoent_with_args --with --args 2"

notfound3:
  command: /path/to/nowhere/bin/hi

notreadable:
  command: /etc/shadow

notreadable2:
  command: /etc/shadow --with-args --path "/test"

dir_not_file:
  command: "/etc"

dir_not_file2:
  command: "/etc --with-args"

notexecable:
  command: "/etc/issue"

sudo_okargs:
  sudo:    root
  command: "check_icmp -n 3 -H tower.svcs.atl.synacor.com"

sudo_okay:
  sudo: root
  command: "check_apacheconfigs"

sudo_bad_user:
  sudo: zimbra
  command: "check_dummy 0 OK as zimbra user"

sudo_403:
  sudo: root
  command: /bin/ls /etc

#####################################################################
#####################################################################
##
##  These checks use `plugin_large' to generate massive amounts
##  of output to exercise NLMA's multi-process write facilities.
##
##  See comments in runway/plugin_large for more details.
##
##  Use of /bin/sh -c '...' is necessary to defeat NLMA's desire
##  to prepend *plugin_root* to relative pathnames, without
##  having to hard-code the CWD of dev opal machines.
##

# 6 chars, and a newline
#
check_6:
  command: /bin/sh -c './runway/plugin_large 2 2 2'

# 4096 chars and a newline.  output should end with a single 'I'
#
check_4k:
  command: /bin/sh -c './runway/plugin_large 4095 1'

# 64k chars and a newline.  output should end with a single 'I'
# (this one hangs if NLMA is broken)
#
check_64k:
  command: /bin/sh -c './runway/plugin_large 4095 61440 1'

# 256k chars and a newline.  output should end with a single 'I'
# (this one hangs if NLMA is broken)
#
check_256k:
  command: /bin/sh -c './runway/plugin_large 4095 61440 196008 1'

# 1024k chars and a newline.  output should end with a single 'I'
# (this one hangs if NLMA is broken)
#
check_1024k:
  command: /bin/sh -c './runway/plugin_large 4095 61440 196008 262144 262144 262144 1'
